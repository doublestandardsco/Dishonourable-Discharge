<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dishonourable Discharge</title>
  <style>
    :root{
      --bg:#0a0a0a; --bg2:#1a1a2e; --bg3:#16213e;
      --red:#ff4757; --vio:#5f27cd; --vio2:#7c3aed; --ora:#ffa500; --blue:#3498db; --green:#27ae60;
      --fg:#e0e0e0; --muted:#9bbcff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Courier New',monospace;color:var(--fg);min-height:100vh;
      background:linear-gradient(135deg,var(--bg),var(--bg2),var(--bg3));padding:18px}
    .wrap{max-width:1000px;margin:0 auto;background:rgba(0,0,0,.9);border:2px solid var(--red);
      border-radius:16px;padding:22px;box-shadow:0 0 40px rgba(255,71,87,.25);position:relative}
    .stamp{position:absolute;top:20px;right:20px;background:var(--red);color:#000;
      padding:7px 14px;border:3px solid #000;transform:rotate(10deg);font-weight:bold}
    h1{margin:0 0 6px;color:var(--red);text-shadow:0 0 18px rgba(255,71,87,.7);letter-spacing:3px;text-align:center}
    .sub{color:var(--vio);text-align:center;margin-bottom:20px}
    .section{background:rgba(255,255,255,.03);border-left:4px solid var(--vio);border-radius:10px;padding:18px;margin:14px 0}
    .title{color:var(--red);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media(max-width:760px){.g2,.g3{grid-template-columns:1fr}}
    label{display:block;margin-bottom:6px;color:var(--vio);font-weight:bold;font-size:.88em;letter-spacing:.5px}
    input,select,textarea{width:100%;padding:10px;background:rgba(0,0,0,.7);border:2px solid var(--vio);border-radius:8px;color:var(--fg)}
    textarea{min-height:80px}
    .btn{background:linear-gradient(45deg,var(--red),#ff6b7a);color:#000;border:none;padding:12px 16px;border-radius:8px;
      font-weight:bold;cursor:pointer;transition:.15s;text-transform:uppercase;letter-spacing:1px}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(255,71,87,.45)}
    .btn.sec{background:linear-gradient(45deg,var(--vio),var(--vio2));color:#fff}
    .btn.alt{background:linear-gradient(45deg,var(--blue),#78a9ff);color:#000}
    .btn.out{background:transparent;border:2px dashed var(--vio);color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .small{font-size:.85em;color:var(--muted)}
    .muted{opacity:.75}
    .good{color:#8ef08e}.bad{color:#ff9aa2}
    .card{border:1px dashed var(--vio);border-radius:10px;padding:10px}
    .dossier{border:2px solid var(--red);border-radius:12px;background:linear-gradient(135deg,rgba(255,71,87,.1),rgba(95,39,205,.1));padding:16px;margin:12px 0;position:relative}
    .dossier:before{content:"CLASSIFIED";position:absolute;top:-10px;left:18px;background:var(--red);color:#000;padding:3px 10px;font-size:.72em;font-weight:bold}
    .code{color:var(--red);font-weight:bold}
    .log{max-height:260px;overflow:auto;background:rgba(0,0,0,.45);border:2px solid var(--vio);border-radius:10px;padding:12px}
    .line{border-left:3px solid var(--vio);padding-left:10px;margin:8px 0;background:rgba(95,39,205,.12);border-radius:4px}
    .hr{height:1px;background:linear-gradient(90deg,transparent,var(--vio),transparent);margin:12px 0}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.78em;font-weight:bold}
    .b-ready{background:var(--green);color:#fff}.b-used{background:#e74c3c;color:#fff}
    .b-lock{background:#f39c12;color:#000}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="stamp">TOP SECRET</div>
    <h1>DISHONOURABLE DISCHARGE</h1>
    <div class="sub">Operation: Alpine Debrief</div>

    <!-- GM PANEL -->
    <div id="gmPanel" class="section">
      <div class="title">üéÆ Game Master Control</div>
      <div class="grid g3">
        <div>
          <label>Game Key</label>
          <input id="sessionId" placeholder="e.g. QT1" />
        </div>
        <div>
          <label>Player Limit</label>
          <select id="playerCount">
            <option>3</option><option>4</option><option>5</option>
            <option selected>6</option><option>8</option><option>12</option>
          </select>
        </div>
        <div>
          <label>Final Night (unlocks scans/accusations)</label>
          <input type="datetime-local" id="finalNightAt"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="createGame()">Create Game</button>
        <button class="btn sec" onclick="refreshState()">Refresh State</button>
        <button class="btn out" onclick="copyGameLink()">Copy Join Link (Key Only)</button>
      </div>
      <div id="gmMsg" class="small" style="margin-top:8px"></div>
      <div id="seatList" class="grid g3" style="margin-top:10px"></div>
    </div>

    <!-- LOGIN PANEL -->
    <div id="loginPanel" class="section">
      <div class="title">üîê Player Login</div>
      <div class="grid g3">
        <div>
          <label>Your Name</label>
          <input id="playerName" placeholder="e.g. Kaleb"/>
        </div>
        <div>
          <label>Game Key</label>
          <input id="gameKeyLogin" placeholder="e.g. QT1"/>
        </div>
        <div>
          <label>Seat Key</label>
          <input id="seatKey" placeholder="e.g. AB1C-9XYZ"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="joinGame()">Join Game</button>
        <button class="btn sec" onclick="refreshState()">Refresh State</button>
      </div>
      <div id="loginMsg" class="small" style="margin-top:8px"></div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashPanel" class="section hidden">
      <div class="title">üßæ Agent Dashboard</div>

      <div class="dossier">
        <div class="row" style="justify-content:space-between">
          <div><span class="code" id="codenameText">‚Äî</span> <span class="small muted">(Agent ID <span id="agentIdText">‚Äî</span>)</span></div>
          <div class="small">Game: <span id="gameKeyText">‚Äî</span> ¬∑ Final Night: <span id="finalNightText">‚Äî</span></div>
        </div>
        <div class="hr"></div>

        <div class="grid g3">
          <div class="card">
            <div class="small muted">Your Name</div>
            <div id="realNameText">‚Äî</div>
            <div class="small muted" style="margin-top:6px">Adopted Character Name</div>
            <div id="aliasText">‚Äî</div>
            <div class="small muted" style="margin-top:6px">Cover Identity</div>
            <div id="coverText">‚Äî</div>
          </div>
          <div class="card">
            <div class="small muted">Operational Role</div>
            <div id="roleText">‚Äî</div>
            <div class="small muted" style="margin-top:6px">Role Objective</div>
            <div id="roleObjective">‚Äî</div>
            <div class="small muted" style="margin-top:6px">Win Condition</div>
            <div id="roleWin">‚Äî</div>
          </div>
          <div class="card">
            <div class="small muted">Secret Mission (you only)</div>
            <div id="secretMissionText">‚Äî</div>
          </div>
        </div>

        <div class="grid g2" style="margin-top:10px">
          <div class="card">
            <div class="small muted">Background</div>
            <div id="backgroundText">‚Äî</div>
          </div>
          <div class="card">
            <div class="small muted">Discharge</div>
            <div id="dischargeText">‚Äî</div>
          </div>
        </div>

        <div class="grid g3" style="margin-top:10px">
          <div class="card">
            <div class="small muted">Perks (table games everyone must respect)</div>
            <ul id="perkList" style="margin:6px 0 0 18px"></ul>
          </div>
          <div class="card">
            <div class="small muted">Behavioral Quirk (always on)</div>
            <div id="quirkText">‚Äî</div>
          </div>
          <div class="card">
            <div class="small muted">Con (your personal embarrassment)</div>
            <div id="conText">‚Äî</div>
          </div>
        </div>

        <div class="card" style="margin-top:10px">
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="small muted">Special Ability</div>
              <div id="abilityName"><strong>‚Äî</strong></div>
              <div class="small" id="abilityDesc">‚Äî</div>
            </div>
            <div>
              <span id="abilityBadge" class="badge b-ready">READY</span>
              <div class="small">Uses Left Today: <span id="abilityUsesLeft">1</span></div>
            </div>
          </div>
          <div class="grid g3" style="margin-top:10px">
            <div>
              <label class="small">Target (optional)</label>
              <select id="abilityTargetSelect"></select>
            </div>
            <div>
              <label class="small">‚Ä¶or type Agent ID</label>
              <input id="abilityTargetId" placeholder="agent_xxx"/>
            </div>
            <div style="align-self:end">
              <button class="btn alt" onclick="useAbility()">Use Ability</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Missions -->
      <div class="section" style="border-left-color:var(--ora)">
        <div class="title">üìã Missions</div>
        <div id="activeMission" class="card">
          <div class="small muted">Active Mission</div>
          <div id="missionText">None. Request one below.</div>
          <div class="row" style="margin-top:8px">
            <button class="btn sec" onclick="requestMission()">Request Mission</button>
            <button class="btn" onclick="completeMission()">Complete Mission</button>
            <button class="btn out" onclick="failMission()">Fail & Redraw</button>
          </div>
          <div class="small" style="margin-top:6px">Completed: <span id="missionCount">0</span></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="section" style="border-left-color:var(--blue)">
        <div class="title">üìù Submit Action / Penalty / Task</div>
        <div class="grid g3">
          <div>
            <label>Action Type</label>
            <select id="actionType">
              <option value="penalty">Report Penalty</option>
              <option value="task_complete">Task Complete</option>
              <option value="murderer_act">Report Murderer Act</option>
              <option value="ability">Use Ability (also above)</option>
            </select>
          </div>
          <div>
            <label>Target Player</label>
            <select id="actionTarget"></select>
          </div>
          <div>
            <label>Details</label>
            <input id="actionDetails" placeholder="What happened / instructions"/>
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn alt" onclick="submitAction()">Submit</button>
        </div>
      </div>

      <!-- Public Roster -->
      <div class="section">
        <div class="title">üóÇÔ∏è Public Roster (bios + perks/quirks/cons)</div>
        <div id="rosterList"></div>
      </div>

      <!-- Log -->
      <div class="section" style="border-left-color:var(--vio2)">
        <div class="title">üì° Operation Log</div>
        <div id="logView" class="log"></div>
      </div>

      <div class="row">
        <button class="btn sec" onclick="refreshState()">Refresh</button>
        <button class="btn out" onclick="leaveSeat()">Leave Seat (Clear Local)</button>
      </div>
    </div>
  </div>

<script>
/* ========== helpers ========== */
const $ = id => document.getElementById(id);
const now = () => Date.now();
const fmt = ts => new Date(ts).toLocaleString();
const pick = a => a[Math.floor(Math.random()*a.length)];
function uiMsg(id, text){ const el=$(id); if(el) el.textContent = text||''; }
function copyText(t){ navigator.clipboard.writeText(t); }

/* ========== roles ========== */
const ROLES = {
  flipped_agent:{ name:"The Flipped Agent", obj:"Stay hidden while sowing chaos. Frame others or recruit allies.", win:"Survive final vote OR flip another player." },
  handler:{ name:"The Handler", obj:"Identify the traitor through investigation and deduction.", win:"Correctly identify the Flipped Agent in the final vote." },
  wildcard:{ name:"The Wildcard", obj:"Survive and adapt; can align with either side.", win:"Align with the winning side OR complete your solo objectives." },
  innocent:{ name:"Innocent Operative", obj:"Identify the traitor and survive the final vote.", win:"Vote out the Flipped Agent OR survive to the end." }
};

/* ========== missions / acts ========== */
const MISSIONS = [
  "Wear ski goggles to dinner; never explain why.",
  "Ask 3 strangers where the CIA safehouse is.",
  "Challenge someone to a snowball duel; loser does a shoey.",
  "Bring a random item to the bar and convince someone it's priceless.",
  "Gain legit access to another player's room for 15 minutes.",
  "Speak only in a fake Russian accent for 3 hours.",
  "Critique outfits using military terminology.",
  "Take a candid photo of every player undetected.",
  "Get someone to break a minor rule for you.",
  "Teach a stranger a codeword and use it later."
];

const MURDERER_ACTS = [
  "Leave one coaster upside-down at a table you visit.",
  "Say the word 'almond' twice in different conversations.",
  "Touch the back of a chair before sitting, every time.",
  "Hum two short notes before speaking, at least three times.",
  "Place a napkin folded into a triangle at a random spot.",
  "Tap the table twice with your index finger before drinking."
];

/* ========== characters (12) ========== */
const CHARACTERS = [
  { alias:"Val√©rie "Val" Marchand", codename:"LACEHUNTER", cover:"Luxury Skiwear Designer",
    publicBio:"French AF comms ‚Üí NATO PSYOPS 'tactical glam'. Gives unsolicited runway checks.",
    privateBio:"Trans man. Busted tailoring a general's thermals. Can't pass a mirror without preening.",
    background:"Former French Air Force comms; reassigned to NATO PSYOPS for 'morale optimization'.",
    discharge:"Non-disciplinary separation after a glitter-related morale incident.",
    secretMission:"Track down the mystery ghoster from a classified Alpine affair and collect 3 clues.",
    perks:["Honorific Lock: others must call you "Monsieur Val".",
           "Style Verdict: on 'Runway check', target holds an awkward 10-sec pose."],
    quirk:"Silk cravat; lip balm mid-sentence; says "Lieutenant Thirsttrap".",
    con:"If he catches his reflection he must stop & preen for 3s.",
    ability:{ name:"Fashion Emergency", desc:"Force any two players to swap one visible clothing item immediately.", usesPerDay:1 },
    role:"wildcard"
  },
  { alias:"Kaimana "Kai" Savai'i", codename:"SNOWBLIND", cover:"Extreme Sports Photographer",
    publicBio:"RFMF (Fiji) recon tracker; can find happy hour with GPS accuracy.",
    privateBio:"Refused to hunt an innocent defector (his brother). Collects slang like shell casings.",
    background:"Reconnaissance & tracking specialist; humanitarian ops liaison.",
    discharge:"Honourable discharge after family conflict.",
    secretMission:"Collect 3 strangers' hometown slang and compile a 'tracking lexicon'.",
    perks:["Breadcrumb Command: choose a trigger word; speakers owe a clue or take penalty for 10 min.",
           "Switchback: say 'First tracks' ‚Üí everyone rotates seats; last seated owes you a favour."],
    quirk:"Whispers intel and ends with 'copy?'.",
    con:"If someone says 'family'/'ohana', must deliver a 1-sentence heartfelt lesson.",
    ability:{ name:"Hire a Tail", desc:"Recruit one player to shadow you 10‚Äì30 min; deliver intel every 5 min or take penalties.", usesPerDay:1 },
    role:"innocent"
  },
  { alias:"Bartosz "Bas" Nowak", codename:"FROSTBITE", cover:"Adventure Safety Coordinator",
    publicBio:"Polish GROM cold-weather specialist. Loves lists & laminated check cards.",
    privateBio:"Interrogation 'cultural differences'. Considers silence a confession.",
    background:"SERE instructor, polar training cadre.",
    discharge:"Honourable; opted out after 'communication' feedback.",
    secretMission:"Convince a stranger to wear your gloves and pose like a crime-scene silhouette.",
    perks:["Interrogator's Pause: on 'Answer the question', target must reply in ‚â§5 words.",
           "Cold Protocol: greetings become fist-bump only until cleared."],
    quirk:"Over-enunciates like radio checks; NATO phonetic for numbers.",
    con:"When asked 'what's the plan?' must show a checklist or salute 'I am improvising.'",
    ability:{ name:"Coerce an Asset", desc:"Designate a player your Asset for 15 min; complete 2 simple tasks or take penalties.", usesPerDay:1 },
    role:"handler"
  },
  { alias:"Ira "Iris" Khatri", codename:"BLACKRUN", cover:"Avalanche Risk Specialist",
    publicBio:"Para (SF) mountain warfare; predicts disasters in people as easily as in snow.",
    privateBio:"Trans man. The avalanche that saved lives also hid sins; won't say whose.",
    background:"High-altitude demo team; SAR & explosives.",
    discharge:"Medical after surviving a unit-ending avalanche.",
    secretMission:"Run a spontaneous 'safety briefing' with strangers and redistribute props they must wear.",
    perks:["Beacon Check: phones face-down 5 min; touching = penalty.",
           "Disaster Brief: two table taps resets topic & assigns next speaker."],
    quirk:"Adds 'allegedly' to claims if alcohol is present.",
    con:"On triangles/angles must estimate degrees aloud; off by >10¬∞ ‚Üí draw a napkin protractor.",
    ability:{ name:"Avalanche Protocol", desc:"Clap twice: 30-sec evac drill. Everyone swaps seats & surrenders a small item; you redistribute.", usesPerDay:1 },
    role:"wildcard"
  },
  { alias:"Pilar "Pili" Casta√±o", codename:"POWDER KEG", cover:"Luxury Lodge Event Coordinator",
    publicBio:"Spanish social engineer; diplomacy with a splash of chaos.",
    privateBio:"Trans man. Ran weapons through receptions. Still RSVP's 'maybe' to Interpol.",
    background:"Human terrain ops; embassy events fixer.",
    discharge:"Dishonourable (creative import/export).",
    secretMission:"Get a stranger to announce you as 'His Excellency the Ambassador of Apr√®s'.",
    perks:["VIP Gate: others must introduce you with a flamboyant invented title.",
           "Guest List: 'You're on the list' ‚Üí 2-min private chat to assign a micro-task."],
    quirk:"Refuses real names; assigns callsigns.",
    con:"On any rumour he must add 'exclusive source' + wink; if asked later 'source?' must admit 'It was me.'",
    ability:{ name:"Task the Mark", desc:"Nominate any player to get a phone #, key/card, or selfie with anyone within 20 min. Failure = penalty.", usesPerDay:1 },
    role:"wildcard"
  },
  { alias:"Dmitri "Dima" Volkov", codename:"ICEPICK", cover:"Artisanal Spirits Consultant",
    publicBio:"Ex-Spetsnaz (allegedly). Measures every drink. Speaks in Celsius.",
    privateBio:"Defected‚Äîor didn't. Awaits a signal only he'd recognize.",
    background:"Urban recon & counter-human intel.",
    discharge:"'Special transfer' during the Sochi Olympics.",
    secretMission:"Learn a new vodka toast and perform it with the group.",
    perks:["Cold Stare: on eye contact the other must break first or penalty.",
           "Vodka Toast Override: on 'Na zdorovye', all must toast; 30s to find alcohol or penalty."],
    quirk:"Answers 'roger' instead of 'yes' and ends sentences with 'over.'",
    con:"When a new person arrives, he must pat pockets: 'ID, keys, exit‚Äîroger'; if caught skipping ‚Üí 10-sec bug sweep.",
    ability:{ name:"Charm Offensive (vodka-only)", desc:"Before midnight compel 3 people to buy you vodka drinks. Refusal/wrong drink = penalty.", usesPerDay:1 },
    role:"innocent"
  },
  { alias:"Rowan "Ro" Hart", codename:"WOLFTRAP", cover:"Night Security Analyst",
    publicBio:"Ex-infantry turned nightclub perimeter whisperer. Hears bouncers before the bass.",
    privateBio:"Trans man. Thinks velvet ropes are guidelines. Once dated a smoke machine.",
    background:"Perimeter defense & crowd control.",
    discharge:"Honourable.",
    secretMission:"Convince a venue staffer to radio-check you using a callsign you invent.",
    perks:["Line Cutter: may insert yourself into any group; someone must introduce you within 20s.",
           "Bouncer's Choice: point to the door; one person must accompany you for a 60s perimeter check."],
    quirk:"Counts exits (quietly) when entering a room.",
    con:"If music changes, must freeze for 3s like a motion sensor.",
    ability:{ name:"Angle Check (10-sec hold)", desc:"Command a target to strike a dramatic pose facing a 'camera' for 10 seconds. Everyone must try not to laugh.", usesPerDay:1 },
    role:"innocent"
  },
  { alias:"Asher "Ash" Del Mar", codename:"SEALEVEL", cover:"Hydro Logistics Planner",
    publicBio:"Special forces boat guy who gets altitude sickness looking at menus.",
    privateBio:"Smuggled a jet-ski into a hotel fountain. Twice.",
    background:"Riverine logistics & insertions.",
    discharge:"Honourable (but wet).",
    secretMission:"Collect three coasters from different venues and arrange a 'map' on the table.",
    perks:["High-Water Mark: pick a 'shoreline' on the table; items crossing it owe you a sip.",
           "Docking Fee: anyone returning to the group pays you a one-word status update."],
    quirk:"Adds boat metaphors to everything.",
    con:"If someone says 'wave', must salute like a lifeguard.",
    ability:{ name:"Harbour Master", desc:"Declare the current table 'Port'. Anyone joining owes you a status report + cheers.", usesPerDay:1 },
    role:"wildcard"
  },
  { alias:"Noah "Knox" Keegan", codename:"SWITCHBACK", cover:"Mountain Bike Guide",
    publicBio:"Downhill brain, uphill charm. Always plotting the next corner.",
    privateBio:"Claims a scar for each Greek letter he remembers. Many letters; suspicious count.",
    background:"Bike-mounted patrol & courier.",
    discharge:"Honourable.",
    secretMission:"Borrow a helmet from someone not in your group and wear it for 2 minutes.",
    perks:["Gear Check: on 'Drop a gear', everyone lowers voice one notch for 2 min.",
           "Trail Marshal: you decide who speaks next for 60s."],
    quirk:"Claps once when he stands up.",
    con:"If someone says 'brake', must freeze mid-gesture for 2s.",
    ability:{ name:"Trail Tax (chaos)", desc:"Pick two people to swap seats & share a 'route apology'.", usesPerDay:1 },
    role:"innocent"
  },
  { alias:"Jamie "Harrow" Quinn", codename:"BONESAW", cover:"Field Medic (Former)",
    publicBio:"Good with stitches; terrible with boundaries. Brings tape to conversations.",
    privateBio:"Kept a toe tag as a bookmark. It fell out at a funeral.",
    background:"Combat medic; mass-casualty triage.",
    discharge:"Honourable; 'bedside manner incompatible with brass'.",
    secretMission:"Bandage (real or improvised) a non-player and get them to rate your care /10.",
    perks:["Triage: you may interrupt any chat to ask 'Vitals?'‚Äîanswer must be a number.",
           "Sterile Field: designate a 30 cm zone around your drink; violators owe an apology shot."],
    quirk:"Calls snacks 'oral medication'.",
    con:"If someone says 'owie', must produce a bandage (real or improvised).",
    ability:{ name:"Scrub In", desc:"Declare an emergency consult; target must whisper their last snack & biggest fear.", usesPerDay:1 },
    role:"wildcard"
  },
  { alias:"Elliot "Ledger" Vance", codename:"COUNTERSIGN", cover:"Casino Surveillance",
    publicBio:"Counts cards, people, and regrets. Mostly people.",
    privateBio:"Wears mirrored sunglasses at night because 'math is bright'.",
    background:"Surveillance, pattern analysis.",
    discharge:"Honourable; immediately banned from three casinos.",
    secretMission:"Convince someone to speak only in numbers with you for 30 seconds.",
    perks:["Tell Read: you may ask someone to repeat a sentence slower.",
           "Double Down: once, force a yes/no commitment from the table."],
    quirk:"Murmurs odds to himself.",
    con:"If anyone says a number >10, must whisper a different random number.",
    ability:{ name:"Background Count", desc:"Ask the GM for a one-line statistical hint about any player.", usesPerDay:1 },
    role:"handler"
  },
  { alias:"Rafe "Static" Moretti", codename:"JAMMER", cover:"RF Tech",
    publicBio:"Carries more antennas than personality. Still‚Ä¶ weirdly charming.",
    privateBio:"Blocked a wedding livestream so the bride's ex couldn't watch. She thanked him.",
    background:"Signals intelligence & EW.",
    discharge:"Honourable; requested more batteries than the army owned.",
    secretMission:"Get a stranger to say 'Say again?' twice in one conversation.",
    perks:["Signal Check: say 'Bars?' ‚Üí everyone must show phone lock screen for 3s.",
           "Dead Zone: pick a corner where nobody may use phones for 5 min."],
    quirk:"Says 'Copy' to compliments.",
    con:"If someone says 'loud', must turn an imaginary knob.",
    ability:{ name:"Static Burst", desc:"Declare a 30-sec 'comms outage': everyone speaks in whispers only.", usesPerDay:1 },
    role:"innocent"
  }
];

/* ========== derived character from seat ========== */
function pickCharacterForSeat(seatKey){
  let h = 0; for(const c of seatKey) h = (h*31 + c.charCodeAt(0)) >>> 0;
  const base =
